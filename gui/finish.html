<!DOCTYPE HTML>
<html>
  <head>
    <title>RangeRovr: Finish</title>
    <meta charset="utf-8" />

    <script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
    <script type="text/javascript">
      var ros = new ROSLIB.Ros({
        url : 'ws://localhost:9090'
      });

      ros.on('connection', function() {
        console.log('Connected to websocket server.');
      });

      ros.on('error', function(error) {
        console.log('Error connecting to websocket server: ', error);
      });

      ros.on('close', function() {
        console.log('Connection to websocket server closed.');
      });

      var donePublisher = new ROSLIB.Topic({
        ros : ros,
        name : '/done',
        messageType : 'std_msgs/Empty'
      });

      var stationNumber;
      var basketCount;
      window.onload = function() {
        var doneButton = document.getElementById("doneButton")
                                    .addEventListener('click', toIndexPage, false);

        var params = location.search.substring(1).split('&');
        stationNumber = params[0].split('=')[1];
        basketCount = params[1].split('=')[1]

        var stationText = document.getElementById('stationNumText');
        stationText.innerHTML += stationNumber;

        var basketText = document.getElementById('basketNumText');
        basketText.innerHTML += basketCount;
      }

      var toIndexPage = function() {
        var doneMessage = new ROSLIB.Message({});

        donePublisher.publish(doneMessage);
        console.log('donePublisher');
        console.log(donePublisher);

        setTimeout(function() {
          location.href = "../gui/index.html";
        }, 100);
      };
    </script>
  </head>
    
  <body>
    <div>
      Thanks for playing and have a fantastic day!
    </div>
    <div id="stationNumText">
      Station Number: 
    </div>
    <div id="basketNumText">
      Baskets Used: 
    </div>
    <button id="doneButton" type="button">Done</button>
  </body>
</html>